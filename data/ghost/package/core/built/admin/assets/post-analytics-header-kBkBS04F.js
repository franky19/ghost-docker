import{r as i,j as e,y as d,aU as L,C as R,aM as H,aR as W,aV as G,aj as I,B as N,aW as T,ap as U,aX as V,aY as z,aZ as A,a_ as b,x as F,a$ as Q,b0 as X,b1 as c,aQ as Z,a0 as q,a1 as J,a2 as K,a3 as ee,a4 as se,a5 as ae,a6 as te,a7 as re}from"./index-DQyPmpGB.js";import{f as ie,N as le,P as ne,g as u}from"./pagemenu-2J5EsqNd.js";import{P as oe}from"./post-share-modal-DSLe_tJv.js";import{u as ce}from"./post-analytics-context-GIqnlcrL.js";import{i as D,h as de,a as me,b as ue}from"./post-helpers-gInwAwEv.js";import{a as xe}from"./posts-C7K9oIZ5.js";import{S as pe,P as he,G as fe,M as ge}from"./wallet-cards-CJX4qjzs.js";import{T as be}from"./trash-Jdu7sKoJ.js";import{S as je}from"./sprout-BHEQ3DeZ.js";const k=i.forwardRef(({...t},r)=>e.jsx("nav",{ref:r,"aria-label":"breadcrumb",...t}));k.displayName="Breadcrumb";const C=i.forwardRef(({className:t,...r},a)=>e.jsx("ol",{ref:a,className:d("flex flex-wrap items-center gap-1.5 break-words text-sm font-medium text-muted-foreground sm:gap-2.5 h-[34px]",t),...r}));C.displayName="BreadcrumbList";const x=i.forwardRef(({className:t,...r},a)=>e.jsx("li",{ref:a,className:d("inline-flex items-center gap-1.5",t),...r}));x.displayName="BreadcrumbItem";const j=i.forwardRef(({asChild:t,className:r,...a},p)=>{const l=t?L:"a";return e.jsx(l,{ref:p,className:d("inline-flex items-center gap-1 transition-colors hover:text-foreground",r),...a})});j.displayName="BreadcrumbLink";const P=i.forwardRef(({className:t,...r},a)=>e.jsx("span",{ref:a,"aria-current":"page","aria-disabled":"true",className:d("font-medium text-foreground",t),role:"link",...r}));P.displayName="BreadcrumbPage";const M=({children:t,className:r,...a})=>e.jsx("li",{"aria-hidden":"true",className:d("[&>svg]:w-3.5 [&>svg]:h-3.5",r),role:"presentation",...a,children:t??e.jsx(R,{})});M.displayName="BreadcrumbSeparator";const Se=({children:t,className:r,...a})=>e.jsx("section",{className:d("flex gap-6 flex-col py-8 size-full grow",r),...a,children:t}),Be=({currentTab:t,children:r})=>{const a=H(),{fromAnalytics:p,appSettings:l}=W(),{mutateAsync:S}=xe(),B=G(),[_,h]=i.useState(!1),[Y,f]=i.useState(!1),{site:w,statsConfig:$,post:s,isPostLoading:g,postId:o}=ce(),{activeVisitors:y,isLoading:v}=ie({postUuid:s?.uuid,statsConfig:$,enabled:l?.analytics?.webAnalytics??!1}),m=i.useMemo(()=>{if(!s)return[];const n=[];return D(s)&&!l?.analytics.webAnalytics||(n.push("Overview"),!s.email_only&&l?.analytics.webAnalytics&&n.push("Web")),de(s)&&n.push("Newsletter"),n.push("Growth"),n},[s,l?.analytics.webAnalytics]),O=()=>{s&&h(!0)},E=async()=>{if(s)try{await S(o),h(!1),a("/posts/",{crossApp:!0})}catch(n){B(n)}};return e.jsxs(e.Fragment,{children:[e.jsx("header",{className:"z-50 -mx-8 bg-white/70 backdrop-blur-md dark:bg-black",children:e.jsx("div",{className:"relative flex min-h-[102px] w-full items-start justify-between gap-5 px-8 pb-0 pt-8","data-header":"header",children:e.jsxs("div",{className:"flex w-full flex-col gap-5",children:[e.jsxs("div",{className:"flex w-full flex-col justify-between md:flex-row md:items-center",children:[e.jsx(k,{children:e.jsxs(C,{children:[p?e.jsx(x,{children:e.jsx(j,{className:"cursor-pointer leading-[24px]",onClick:()=>a("/analytics/",{crossApp:!0}),children:"Analytics"})}):e.jsx(x,{children:e.jsx(j,{className:"cursor-pointer leading-[24px]",onClick:()=>a("/posts/",{crossApp:!0}),children:"Posts"})}),e.jsx(M,{}),e.jsx(x,{children:e.jsx(P,{className:"leading-[24px]",children:"Post analytics"})})]})}),e.jsxs("div",{className:"flex w-full items-center gap-2 md:w-auto",children:[l?.analytics.webAnalytics&&!s?.email_only&&e.jsx("div",{className:"mr-3 flex grow items-center gap-2 text-sm md:grow-0",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",title:"Active readers in the last 5 minutes Â· Updates every 60 seconds",children:[e.jsxs("span",{className:"text-sm",children:[v?"":I(y)," reading now"]}),e.jsx("div",{className:`size-2 rounded-full ${v?"animate-pulse bg-muted":y?"bg-green-500":"border border-muted-foreground"}`})]})}),!g&&e.jsxs(e.Fragment,{children:[!s?.email_only&&e.jsx(oe,{author:s?.authors?.[0]?.name||"",description:"",faviconURL:w?.icon||"",featureImageURL:s?.feature_image,open:Y,postExcerpt:s?.excerpt||"",postTitle:s?.title,postURL:s?.url,siteTitle:w?.title||"",onClose:()=>f(!1),onOpenChange:f,children:e.jsxs(N,{variant:"outline",onClick:()=>f(!0),children:[e.jsx(pe,{})," Share"]})}),e.jsxs(T,{children:[e.jsx(U,{asChild:!0,children:e.jsx(N,{variant:"outline",children:e.jsx(V,{})})}),e.jsxs(z,{align:"end",children:[e.jsxs(A,{children:[e.jsx(b,{asChild:!0,children:e.jsxs("a",{href:s?.url,rel:"noopener noreferrer",target:"_blank",children:[e.jsx(F,{}),"View in browser"]})}),e.jsxs(b,{onClick:()=>{a(`/editor/post/${o}`,{crossApp:!0})},children:[e.jsx(he,{}),"Edit post"]})]}),e.jsx(Q,{}),e.jsx(A,{children:e.jsxs(b,{className:"text-destructive focus:text-destructive",onClick:O,children:[e.jsx(be,{}),"Delete post"]})})]})]})]})]})]}),!g&&e.jsxs("div",{className:"flex items-start gap-6 md:items-center",children:[s?.feature_image&&e.jsx("div",{className:"aspect-[16/10] w-full max-w-[100px] rounded-md bg-cover bg-center md:max-w-[132px]",style:{backgroundImage:`url(${s.feature_image})`}}),e.jsxs("div",{children:[e.jsx(X,{className:"-ml-px max-w-[920px] indent-0 text-xl md:min-h-[35px] md:text-3xl md:leading-[1.2em]","data-header":"header-title",children:s?.title}),s?.published_at&&e.jsxs("div",{className:"mt-0.5 flex items-center justify-start text-sm leading-[1.65em] text-muted-foreground",children:[me(s)&&`Sent on ${c(s.published_at).format("D MMM YYYY")} at ${c(s.published_at).format("HH:mm")}`,D(s)&&`Published on your site on ${c(s.published_at).format("D MMM YYYY")} at ${c(s.published_at).format("HH:mm")}`,ue(s)&&`Published and sent on ${c(s.published_at).format("D MMM YYYY")} at ${c(s.published_at).format("HH:mm")}`]})]})]})]})})}),e.jsxs(le,{className:"sticky top-0 z-50 -mb-8 transform-gpu flex-col items-start gap-y-0 border-none bg-white/70 py-8 backdrop-blur-md lg:flex-row lg:items-center dark:bg-black",children:[!g&&e.jsxs(ne,{className:"min-h-[34px]",defaultValue:t,responsive:!0,children:[m.includes("Overview")&&e.jsxs(u,{value:"Overview",onClick:()=>{a(`/posts/analytics/${o}`)},children:[e.jsx(fe,{}),"Overview"]}),m.includes("Web")&&e.jsxs(u,{value:"Web",onClick:()=>{a(`/posts/analytics/${o}/web`)},children:[e.jsx(Z,{}),"Web traffic"]}),m.includes("Newsletter")&&e.jsxs(u,{value:"Newsletter",onClick:()=>{a(`/posts/analytics/${o}/newsletter`)},children:[e.jsx(ge,{}),"Newsletter"]}),m.includes("Growth")&&e.jsxs(u,{value:"Growth",onClick:()=>{a(`/posts/analytics/${o}/growth`)},children:[e.jsx(je,{}),"Growth"]})]}),r]}),e.jsx(q,{open:_,onOpenChange:h,children:e.jsxs(J,{children:[e.jsxs(K,{children:[e.jsx(ee,{children:"Are you sure you want to delete this post?"}),e.jsxs(se,{children:[`You're about to delete "`,e.jsx("strong",{children:s?.title}),'". This is permanent! We warned you, k?']})]}),e.jsxs(ae,{children:[e.jsx(te,{children:"Cancel"}),e.jsx(re,{className:"hover:bg-red-700 bg-red-600 text-white",onClick:E,children:"Delete"})]})]})})]})};export{Be as P,Se as a};

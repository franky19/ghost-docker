import{aM as Y,r as k,b3 as C,b4 as z,j as e,S as f,bU as se,B as A,aQ as M,aj as d,y as W,ai as Q,ci as te,aN as le,cf as H,e as ce,ch as q,cD as de,bP as me,cE as J,bS as ue,cF as pe,af as xe,ag as T,aT as U,_ as he}from"./index-DQyPmpGB.js";import{g as S,S as ge,a as fe,D as be,b as je}from"./stats-view-A5TqI_uq.js";import{C as $,a as D,b as F,h as R,c as V,E as ve,K as Ne,d as we,e as ye,u as ke,j as _e}from"./pagemenu-2J5EsqNd.js";import{E as P}from"./empty-indicator-CYjCOvfy.js";import{P as Ce}from"./post-share-modal-DSLe_tJv.js";import{g as Ae,c as Le}from"./post-helpers-gInwAwEv.js";import{S as Te,U as ae}from"./wallet-cards-CJX4qjzs.js";import{h as Me,i as K,d as ze,j as We,L as $e,k as X,l as Z,C as De}from"./lucide-react-C6c1xSTE.js";import{G}from"./gh-chart-DG-gbkHv.js";import{g as Fe}from"./audience-select-6lBhMsUK.js";import{u as Re}from"./use-growth-stats-BFLjNr3F.js";import{u as Ve}from"./posts-C7K9oIZ5.js";import{i as Ee,j as Ie}from"./stats-B1umFX9r.js";import"./select-CEu-ZfzV.js";import"./message-square-text-C7V7BkDm.js";import"./sprout-BHEQ3DeZ.js";import"./a-large-small-f8xnoB_N.js";import"./at-sign-DUdEmRQR.js";import"./copy-Bw8gMMdK.js";import"./hash-PFOEsGbs.js";import"./inbox-C1VV1YxX.js";import"./minus-tKuPyWK9.js";import"./tags-DeAucoMX.js";import"./square-CwuHAXtO.js";import"./user-round-check-CP0ms9Dv.js";import"./repeat-BwHSJqPl.js";import"./reply-BxReOZlh.js";import"./trash-Jdu7sKoJ.js";import"./chart-BtaWHe7b.js";import"./_baseAssignValue-ImTGDFcZ.js";import"./currency-fEUUCkj0.js";const Ue=s=>s.email_only?"Sent":s.email?"Published and sent":"Published",Ge=({latestPostStats:s,isLoading:o})=>{const a=Y(),[r,i]=k.useState(!1),{site:l,settings:u}=C(),{appSettings:n}=z(),{emailTrackClicks:p,emailTrackOpens:t}=n?.analytics||{},c=l.title||String(u.find(g=>g.key==="title")?.value||"Ghost Site"),x=s?Ae(s,{membersTrackSources:n?.analytics.membersTrackSources}):null,b="group mr-2 flex flex-col gap-1.5 hover:cursor-pointer";return e.jsxs($,{className:"group/card bg-gradient-to-tr from-muted/40 to-muted/0 to-50%","data-testid":"latest-post",children:[e.jsxs(D,{children:[e.jsx(F,{className:"flex items-baseline justify-between font-medium leading-snug text-muted-foreground",children:"Latest post performance"}),e.jsx(R,{className:"hidden",children:"How your last post did"})]}),e.jsxs(V,{className:"flex flex-col gap-6 px-0 lg:flex-row xl:grid xl:grid-cols-3",children:[o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex w-full items-center gap-6 px-6 xl:col-span-2",children:[e.jsx("div",{className:"w-full max-w-[232px] grow",children:e.jsx(f,{className:"aspect-[16/10] rounded-md"})}),e.jsxs("div",{className:"w-full grow",children:[e.jsx(f,{className:"w-full max-w-[420px]"}),e.jsx(f,{className:"w-1/2"})]})]}),e.jsx("div",{className:"flex flex-col items-stretch gap-2 px-6 text-sm",children:e.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[e.jsxs("div",{children:[e.jsx(f,{className:"w-3/4"}),e.jsx(f,{className:"h-10 w-1/3"})]}),e.jsxs("div",{children:[e.jsx(f,{className:"w-3/4"}),e.jsx(f,{className:"h-10 w-1/3"})]}),e.jsxs("div",{children:[e.jsx(f,{className:"w-3/4"}),e.jsx(f,{className:"h-10 w-1/3"})]}),e.jsxs("div",{children:[e.jsx(f,{className:"w-3/4"}),e.jsx(f,{className:"h-10 w-1/3"})]})]})})]}),!o&&s&&x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col gap-6 px-6 transition-all md:flex-row md:items-start xl:col-span-2",children:[s.feature_image&&e.jsx("div",{className:"aspect-[16/10] w-full min-w-[100px] rounded-sm bg-cover bg-center sm:max-w-[170px] lg:max-w-[170px] xl:max-w-[232px]",style:{backgroundImage:`url(${s.feature_image})`}}),e.jsxs("div",{className:"flex grow flex-col items-start justify-center self-stretch",children:[e.jsx("div",{className:"text-lg font-semibold leading-tighter tracking-tight hover:cursor-pointer hover:opacity-75",onClick:()=>{!o&&s&&a(`/posts/analytics/${s.id}`,{crossApp:!0})},children:s.title}),e.jsxs("div",{className:"mt-0.5 text-sm text-muted-foreground",children:[s.authors&&s.authors.length>0&&e.jsxs("div",{children:["By ",s.authors.map(g=>g.name).join(", ")," – ",se(s.published_at)]}),e.jsx("div",{className:"mt-0.5",children:Ue(s)})]}),e.jsxs("div",{className:"mt-6 flex items-center gap-2",children:[!s.email_only&&e.jsx(Ce,{author:s.authors?.map(g=>g.name).join(", ")||"",description:"",faviconURL:l.icon||"",featureImageURL:s.feature_image||"",open:r,postExcerpt:s.excerpt||"",postTitle:s.title,postURL:s.url||"",siteTitle:c,onClose:()=>i(!1),onOpenChange:i,children:e.jsxs(A,{onClick:()=>i(!0),children:[e.jsx(Te,{})," Share post"]})}),e.jsxs(A,{className:s.email_only?"w-full":"",variant:"outline",onClick:()=>{a(`/posts/analytics/${s.id}`,{crossApp:!0})},children:[e.jsx(Me,{}),e.jsx("span",{className:"hidden md:!visible md:!block",children:s.email_only?"Post analytics":"Analytics"})]})]})]})]}),e.jsx("div",{className:"-ml-4 flex w-full flex-col items-stretch gap-2 pr-6 text-sm xl:h-full xl:max-w-none",children:e.jsxs("div",{className:"grid grid-cols-2 gap-6 pl-10 lg:border-l xl:h-full",children:[x.showWebMetrics&&n?.analytics.webAnalytics&&e.jsxs("div",{className:b,"data-testid":"latest-post-visitors",onClick:()=>{a(`/posts/analytics/${s.id}/web`,{crossApp:!0})},children:[e.jsxs("div",{className:"flex items-center gap-1.5 font-medium text-muted-foreground transition-all group-hover:text-foreground",children:[e.jsx(M,{size:16,strokeWidth:1.25}),e.jsx("span",{className:"hidden md:!visible md:!block",children:"Visitors"})]}),e.jsx("span",{className:"text-[2.2rem] font-semibold leading-none tracking-tighter",children:d(s.visitors)})]}),x.showMemberGrowth&&e.jsxs("div",{className:W(b,x.showEmailMetrics&&(!x.showWebMetrics||!n?.analytics.webAnalytics)&&"row-[2/3] col-[1/2]"),"data-testid":"latest-post-members",onClick:()=>{a(`/posts/analytics/${s.id}/growth`,{crossApp:!0})},children:[e.jsxs("div",{className:"flex items-center gap-1.5 font-medium text-muted-foreground transition-all group-hover:text-foreground",children:[e.jsx(ae,{size:16,strokeWidth:1.25}),e.jsx("span",{className:"hidden md:!visible md:!block",children:"Members"})]}),e.jsx("span",{className:"text-[2.2rem] font-semibold leading-none tracking-tighter",children:s.member_delta?e.jsxs(e.Fragment,{children:["+",d(s.member_delta)]}):0})]}),x.showEmailMetrics&&s.email&&e.jsxs(e.Fragment,{children:[t&&e.jsxs("div",{className:b,onClick:()=>{a(`/posts/analytics/${s.id}/newsletter`,{crossApp:!0})},children:[e.jsxs("div",{className:"flex items-center gap-1.5 font-medium text-muted-foreground transition-all group-hover:text-foreground",children:[e.jsx(K,{size:16,strokeWidth:1.25}),e.jsx("span",{className:"hidden whitespace-nowrap md:!visible md:!block",children:"Opens"})]}),e.jsx("span",{className:"text-[2.2rem] font-semibold leading-none tracking-tighter",children:s.email.email_count?Q((s.email.opened_count||0)/s.email.email_count):"0%"})]}),p&&e.jsxs("div",{className:b,onClick:()=>{a(`/posts/analytics/${s.id}/newsletter`,{crossApp:!0})},children:[e.jsxs("div",{className:"flex items-center gap-1.5 font-medium text-muted-foreground transition-all group-hover:text-foreground",children:[e.jsx(ze,{size:16,strokeWidth:1.25}),e.jsx("span",{className:"hidden whitespace-nowrap md:!visible md:!block",children:"Clicks"})]}),e.jsx("span",{className:"text-[2.2rem] font-semibold leading-none tracking-tighter",children:s.email.email_count&&s.count?.clicks?Q((s.count.clicks||0)/s.email.email_count):"0%"})]})]})]})})]}):!o&&e.jsx(P,{actions:e.jsx(A,{variant:"secondary",onClick:()=>{a("/editor/post",{crossApp:!0})},children:"New post"}),className:"w-full pb-10 xl:col-span-3",description:"Once it's live, you can track performance here",title:"Publish your first post",children:e.jsx(te,{strokeWidth:1.5})})]})]})},Be=()=>{const{data:s}=C();return{isLimited:a=>{const r=s?.config;return r?.hostSettings?.limits&&a==="limitAnalytics"?r.hostSettings.limits.limitAnalytics?.disabled===!0:!1}}},B=({title:s,iconName:o,description:a,color:r,diffDirection:i,diffValue:l,formattedValue:u,trendingFromValue:n,children:p,onClick:t})=>{const{range:c}=C(),x=o&&$e[o],b=ce.useMemo(()=>{if(!i||i==="empty"||c===q.allTime.value||!l)return"";const g=i==="up"?"up":i==="down"?"down":"at",N=S(c).replace("in the ","").replace(/^\(|\)$/g,"");return i==="same"?e.jsxs("span",{children:["You're trending at the same level as ",e.jsx("span",{className:"font-semibold",children:u})," compared to the ",e.jsx("span",{className:"font-semibold",children:N})]}):e.jsxs("span",{children:["You're trending ",e.jsxs("span",{className:"font-semibold",children:[g," ",l]})," from ",e.jsx("span",{className:"font-semibold",children:n})," compared to the ",N]})},[i,l,n,u,c]);return e.jsxs($,{className:"group","data-testid":s,children:[e.jsxs(D,{className:"hidden",children:[e.jsx(F,{children:s}),e.jsx(R,{children:a})]}),e.jsxs(Ne,{className:"relative flex grow flex-row items-start justify-between gap-5 border-none pb-2 xl:pb-4",children:[e.jsxs("div",{className:"flex grow flex-col gap-1.5 border-none pb-0",children:[e.jsxs(we,{className:t&&"transition-all group-hover:text-foreground",children:[r&&e.jsx("span",{className:"inline-block size-2 rounded-full opacity-50",style:{backgroundColor:r}}),x&&e.jsx(x,{size:16,strokeWidth:1.5}),s]}),e.jsx(ye,{diffDirection:c===q.allTime.value?"hidden":i,diffTooltip:b,diffValue:l,value:u})]}),t&&e.jsx(A,{className:"absolute right-6 translate-x-10 opacity-0 transition-all duration-200 group-hover:translate-x-0 group-hover:opacity-100",size:"sm",variant:"outline",onClick:t,children:"View more"})]}),e.jsx(V,{children:p})]})},Oe=({kpiValues:s,visitorsChartData:o,visitorsYRange:a,growthTotals:r,membersChartData:i,mrrChartData:l,currencySymbol:u,isLoading:n})=>{const p=Y(),{range:t}=C(),{appSettings:c}=z(),b=Be().isLimited("limitAnalytics"),g="-mb-3 h-[10vw] max-h-[200px] min-h-[100px] hover:!cursor-pointer";if(n)return e.jsx(ve,{className:"flex h-[calc(10vw+116px)] max-h-[416px] min-h-20 items-center justify-center hover:!cursor-pointer",children:e.jsx(le,{})});const _=c?.analytics.webAnalytics,N=b&&!_,E=!0,w=c?.paidMembersEnabled,L=[_,N,E,w].filter(Boolean).length;let j="lg:grid-cols-3";L===2?j="lg:grid-cols-2":L===1&&(j="lg:grid-cols-1");const I=`flex flex-col lg:grid ${j} gap-6`;return e.jsxs("div",{className:I,children:[_&&!N&&e.jsx(B,{description:"Number of individual people who visited your website",diffDirection:"empty",formattedValue:s.visits,iconName:"Globe",linkto:"/analytics/web/",title:"Unique visitors",onClick:()=>{p("/analytics/web/")},children:e.jsx(G,{className:g,color:"hsl(var(--chart-blue))",data:o,id:"visitors",range:t,showHorizontalLines:!0,showYAxisValues:!1,syncId:"overview-charts",yAxisRange:a})}),N&&e.jsxs($,{children:[e.jsxs(D,{className:"hidden",children:[e.jsx(F,{children:"Unlock web analytics"}),e.jsx(R,{children:"Get the full picture of what's working with detailed, cookie-free traffic analytics."})]}),e.jsx(V,{className:"flex h-full items-center justify-center p-6",children:e.jsx(P,{actions:e.jsx(A,{variant:"outline",onClick:()=>p("/pro",{crossApp:!0}),children:"Upgrade now"}),className:"py-10",description:"Get the full picture of what's working with detailed, cookie-free traffic analytics.",title:"Unlock web analytics",children:e.jsx(We,{})})})]}),e.jsx(B,{description:"How number of members of your publication changed over time",diffDirection:r.directions.total,diffValue:r.percentChanges.total,formattedValue:d(r.totalMembers),iconName:"User",linkto:"/analytics/growth/",title:"Members",trendingFromValue:`${d(i[0].value)}`,onClick:()=>{p("/analytics/growth/?tab=total-members")},children:e.jsx(G,{className:g,color:"hsl(var(--chart-darkblue))",data:i,id:"members",range:t,showHorizontalLines:!0,showYAxisValues:!1,syncId:"overview-charts"})}),w&&e.jsx(B,{description:"Monthly recurring revenue changes over time",diffDirection:r.directions.mrr,diffValue:r.percentChanges.mrr,formattedValue:`${u}${d(H(r.mrr))}`,iconName:"Coins",linkto:"/analytics/growth/",title:"MRR",trendingFromValue:`${u}${d(l[0].value)}`,onClick:()=>{p("/analytics/growth/?tab=mrr")},children:e.jsx(G,{className:g,color:"hsl(var(--chart-teal))",data:l,id:"mrr",range:t,showHorizontalLines:!0,showYAxisValues:!1,syncId:"overview-charts"})})]})},He=({className:s})=>e.jsx("div",{className:W("rounded-sm bg-muted dark:bg-[#36373a] flex flex-col items-center justify-center gap-1 p-6",s),children:e.jsx(de,{className:"text-muted-foreground/50",size:18,strokeWidth:1.5})}),O=({className:s,metrics:o,title:a})=>e.jsx(e.Fragment,{children:e.jsxs("div",{className:W("pointer-events-none absolute bottom-[calc(100%+2px)] left-1/2 z-50 min-w-[160px] -translate-x-1/2 rounded-md bg-background p-3 text-sm opacity-0 shadow-md transition-all group-hover/tooltip:bottom-[calc(100%+12px)] group-hover/tooltip:opacity-100",s),children:[e.jsx("div",{className:"mb-1.5 whitespace-nowrap border-b pb-1.5 pr-10 font-medium text-muted-foreground",children:a}),e.jsx("div",{className:"flex flex-col gap-1.5",children:o?.map(r=>e.jsxs("div",{className:"flex items-center justify-between gap-5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 whitespace-nowrap",children:[r.icon,r.label]}),e.jsx("span",{className:"font-mono",children:r.metric})]},r.label))})]})}),Se=({topPostsData:s,isLoading:o})=>{const a=Y(),{range:r}=C(),{appSettings:i}=z(),l=i?.analytics.webAnalytics,u=i?.analytics.emailTrackClicks,n=i?.analytics.emailTrackOpens,p="flex items-center justify-end gap-1 rounded-md px-2 py-1 font-mono text-gray-800 hover:bg-muted-foreground/10 group-hover:text-foreground";return e.jsxs($,{className:"group/card w-full lg:col-span-2","data-testid":"top-posts-card",children:[e.jsxs(D,{children:[e.jsxs(F,{className:"flex items-baseline justify-between font-medium  leading-snug text-muted-foreground",children:["Top posts ",S(r)]}),e.jsx(R,{className:"hidden",children:"Most viewed posts in this period"})]}),e.jsx(V,{children:o?e.jsx(me,{className:"mt-6"}):e.jsxs(e.Fragment,{children:[s?.stats?.map(t=>e.jsxs("div",{className:'group relative flex w-full items-start justify-between gap-5 border-t border-border/50 py-4 before:absolute before:-inset-x-4 before:inset-y-0 before:z-0 before:hidden before:rounded-md before:bg-accent before:opacity-80 before:content-[""] first:!border-border hover:cursor-pointer hover:border-transparent hover:before:block md:items-center dark:before:bg-accent/50 [&+div]:hover:border-transparent',children:[e.jsxs("div",{className:"z-10 flex min-w-[160px] grow items-start gap-4 md:items-center lg:min-w-[320px]",onClick:()=>{a(`/posts/analytics/${t.post_id}`,{crossApp:!0})},children:[t.feature_image?e.jsx("div",{className:"hidden aspect-[16/10] w-[80px] shrink-0 rounded-sm bg-cover bg-center sm:!visible sm:!block lg:w-[100px]",style:{backgroundImage:`url(${t.feature_image})`}}):e.jsx(He,{className:"hidden aspect-[16/10] w-[80px] shrink-0 group-hover:bg-muted-foreground/10 sm:!visible sm:!flex lg:w-[100px]"}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"line-clamp-2 text-lg font-semibold leading-[1.35em]",children:t.title}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:["By ",t.authors," – ",se(t.published_at)]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:Le(t)})]})]}),e.jsxs("div",{className:"z-10 flex flex-col items-end justify-center gap-0.5 text-sm md:flex-row md:items-center md:justify-end md:gap-3",children:[l&&e.jsxs("div",{className:"group/tooltip relative flex w-[66px] lg:w-[92px]","data-testid":"statistics-visitors",onClick:c=>{c.stopPropagation(),a(`/posts/analytics/${t.post_id}/web`,{crossApp:!0})},children:[e.jsx(O,{metrics:[{icon:e.jsx(M,{className:"shrink-0 text-muted-foreground",size:16,strokeWidth:1.5}),label:"Unique visitors",metric:d(t.views)}],title:"Web traffic"}),e.jsxs("div",{className:p,children:[e.jsx(M,{className:"text-muted-foreground group-hover:text-foreground",size:16,strokeWidth:1.5}),J(t.views)]})]}),t.sent_count!==null&&e.jsxs("div",{className:"group/tooltip relative flex w-[66px] lg:w-[92px]",onClick:c=>{c.stopPropagation(),a(`/posts/analytics/${t.post_id}/newsletter`,{crossApp:!0})},children:[e.jsx(O,{className:`${i?.analytics.membersTrackSources?"":"left-auto right-0 translate-x-0"}`,metrics:[{icon:e.jsx(X,{className:"shrink-0 text-muted-foreground",size:16,strokeWidth:1.5}),label:"Sent",metric:d(t.sent_count||0)},...n?[{icon:e.jsx(K,{className:"shrink-0 text-muted-foreground",size:16,strokeWidth:1.5}),label:"Opens",metric:d(t.opened_count||0)}]:[],...u?[{icon:e.jsx(Z,{className:"shrink-0 text-muted-foreground",size:16,strokeWidth:1.5}),label:"Clicks",metric:d(t.clicked_count||0)}]:[]],title:"Newsletter performance"}),e.jsx("div",{className:p,children:n?e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"text-muted-foreground group-hover:text-foreground",size:16,strokeWidth:1.5}),t.open_rate?`${Math.round(t.open_rate)}%`:"0%"]}):u?e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"text-muted-foreground group-hover:text-foreground",size:16,strokeWidth:1.5}),t.click_rate?`${Math.round(t.click_rate)}%`:"0%"]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"text-muted-foreground group-hover:text-foreground",size:16,strokeWidth:1.5}),J(t.sent_count||0)]})})]}),i?.analytics.membersTrackSources&&e.jsxs("div",{className:"group/tooltip relative flex w-[66px] lg:w-[92px]","data-testid":"statistics-members",onClick:c=>{c.stopPropagation(),a(`/posts/analytics/${t.post_id}/growth`,{crossApp:!0})},children:[e.jsx(O,{className:"left-auto right-0 translate-x-0",metrics:[{icon:e.jsx(ue,{className:"shrink-0 text-muted-foreground",size:16,strokeWidth:1.5}),label:"Free",metric:t.free_members>0?`+${d(t.free_members)}`:"0"},...i?.paidMembersEnabled?[{icon:e.jsx(pe,{className:"shrink-0 text-muted-foreground",size:16,strokeWidth:1.5}),label:"Paid",metric:t.paid_members>0?`+${d(t.paid_members)}`:"0"}]:[]],title:"New members"}),e.jsxs("div",{className:p,children:[e.jsx(ae,{className:"text-muted-foreground group-hover:text-foreground",size:16,strokeWidth:1.5}),t.members>0?`+${d(t.members)}`:"0"]})]})]})]},t.post_id)),(!s?.stats||s.stats.length===0)&&e.jsx(P,{className:"w-full pb-10",title:`No posts ${S(r)}`,children:e.jsx(te,{strokeWidth:1.5})})]})})]})},Ke=()=>{const{data:{posts:[s]}={posts:[]},isLoading:o}=Ve({searchParams:{filter:"status:[published,sent]",order:"published_at DESC",limit:"1",include:"authors,email,count.clicks"}}),a=s,r=Ee(a?.id||"",{enabled:!!a?.id}),{data:i,isLoading:l}=r;return{data:k.useMemo(()=>{if(!a)return null;const n=i?.stats?.[0]||{id:a.id,recipient_count:null,opened_count:null,open_rate:null,member_delta:0,free_members:0,paid_members:0,visitors:0};return{id:a.id,uuid:a.uuid,title:a.title||"",slug:a.slug||"",feature_image:a.feature_image||null,published_at:a.published_at||"",url:a.url||"",excerpt:a.excerpt||"",email_only:a.email_only||!1,status:a.status,email:a.email,count:a.count,authors:a.authors||[],recipient_count:n.recipient_count,opened_count:n.opened_count,open_rate:n.open_rate,member_delta:n.member_delta,free_members:n.free_members,paid_members:n.paid_members,visitors:n.visitors,click_rate:null}},[a,i]),isLoading:o||!!a?.id&&l}},ee=({className:s,title:o,description:a,url:r,children:i})=>e.jsx("a",{className:W("block rounded-xl border bg-card p-6 transition-all hover:shadow-xs hover:bg-accent/50 group/card",s),href:r,rel:"noreferrer",target:"_blank",children:e.jsxs("div",{className:"flex items-center gap-6",children:[i,e.jsxs("div",{className:"flex flex-col gap-0.5 leading-tight",children:[e.jsx("span",{className:"text-base font-semibold",children:o}),e.jsx("span",{className:"text-sm font-normal text-gray-700",children:a})]})]})}),ks=()=>{const{appSettings:s}=z(),{statsConfig:o,isLoading:a,range:r,audience:i}=C(),{startDate:l,endDate:u,timezone:n}=xe(r),{isLoading:p,chartData:t,totals:c,currencySymbol:x}=Re(r),{data:b,isLoading:g}=Ke(),{data:_,isLoading:N}=Ie({searchParams:{date_from:T(l),date_to:T(u),limit:"5",timezone:n}}),E={site_uuid:o?.id||"",date_from:T(l),date_to:T(u),timezone:n,member_status:Fe(i)},{data:w,loading:L}=ke({endpoint:"api_kpis",statsConfig:o,params:E}),j=k.useMemo(()=>U(w||[],r,"visits","sum")?.map(h=>{const v=Number(h.visits),y=isNaN(v)?0:v;return{date:String(h.date),value:y,formattedValue:d(y),label:"Visitors"}}),[w,r]),I=k.useMemo(()=>{const h=[0,1];if(!j||j.length===0)return h;const v=j.map(m=>m.value).filter(m=>m>=0);return v.length===0?h:[0,Math.max(...v)||h[1]]},[j]),re=k.useMemo(()=>{if(!t||t.length===0)return[];let h=[];return h=U(t,r,"value","exact"),h.map(m=>({date:m.date,value:m.free+m.paid,formattedValue:d(m.free+m.paid),label:"Members"}))},[t,r]),ie=k.useMemo(()=>{if(!s?.paidMembersEnabled||!t||t.length===0)return[];let h=[];return h=U(t,r,"mrr","exact"),h.map(m=>({date:m.date,value:H(m.mrr),formattedValue:`${x}${d(H(m.mrr))}`,label:"MRR"}))},[t,r,x,s]),ne=k.useMemo(()=>{if(!w?.length)return{visits:"0"};const h=w.reduce((v,y)=>{const m=Number(y.visits);return v+(isNaN(m)?0:m)},0);return{visits:d(h)}},[w]),oe=a;return e.jsxs(ge,{children:[e.jsx(fe,{children:e.jsx(_e,{children:e.jsx(be,{excludeRanges:["today"]})})}),e.jsxs(je,{isLoading:oe,loadingComponent:e.jsx(e.Fragment,{}),children:[e.jsx(Oe,{currencySymbol:x,growthTotals:c,isLoading:L||p,kpiValues:ne,membersChartData:re,mrrChartData:ie,visitorsChartData:j,visitorsYRange:I}),e.jsx(Ge,{isLoading:g,latestPostStats:b}),e.jsx(Se,{isLoading:N,topPostsData:_}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[e.jsx(he,{className:"-mb-4 mt-4 lg:col-span-2",children:"Grow your audience"}),e.jsx(ee,{description:"Find out how to review the performance of your content and get the most out of post analytics in Ghost.",title:"Understanding analytics in Ghost",url:"https://ghost.org/help/native-analytics",children:e.jsx("div",{className:"flex h-18 w-[100px] min-w-[100px] items-center justify-center rounded-md bg-gradient-to-tr from-[#14B8FF]/20 to-[#00BBA7]/20 p-4 opacity-80 transition-all group-hover/card:opacity-100",children:e.jsx(De,{className:"text-[#00BBA7]",size:20,strokeWidth:1.5})})}),e.jsx(ee,{description:"Use these content distribution tactics to get more people to discover your work and increase engagement.",title:"How to get your content seen online",url:"https://ghost.org/resources/content-distribution/",children:e.jsx("div",{className:"flex h-18 w-[100px] min-w-[100px] items-center justify-center rounded-md bg-gradient-to-tl from-[#FDC700]/20 to-[#FF2056]/20 p-4 opacity-80 transition-all group-hover/card:opacity-100",children:e.jsx(M,{className:"text-[#FE9A00]",size:20,strokeWidth:1.5})})})]})]})]})};export{ks as default};
